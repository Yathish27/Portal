<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plurall AI Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

        :root {
            --color-primary: #3b82f6; /* Blue */
            --color-secondary: #8b5cf6; /* Purple */
            --color-success: #10b981; /* Green */
            --color-warning: #f59e0b; /* Orange */
            --color-text-dark: #1f2937;
            --color-text-subtle: #6b7280;
            --color-bg-light: #f9fafb;
            --color-white: #ffffff;
            --border-radius: 0.75rem; /* 12px */
            --shadow-card: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-light);
            margin: 0;
            padding: 0;
        }

        /* --- Layout --- */
        .dashboard-layout {
            display: flex;
            min-height: 100vh;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 288px; /* w-72 */
            background-color: var(--color-white);
            border-right: 1px solid #e5e7eb;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.03);
            padding: 1.5rem 0;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            height: 100vh; /* Full height for desktop */
        }
        .sidebar-logo {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }
        .sidebar-logo img {
            max-width: 100%;
            height: auto;
            width: 150px;
            display: block;
        }
        .sidebar-nav {
            padding: 0 1rem;
            flex-grow: 1;
        }
        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #9ca3af;
            margin-bottom: 0.75rem;
            padding: 0 0.5rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            color: var(--color-text-subtle);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-item:hover:not(.active) {
            background-color: #f3f4f6;
            color: var(--color-primary);
        }
        .nav-item.active {
            background-color: var(--color-primary);
            color: var(--color-white);
            font-weight: 600;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.2);
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
        }

        /* --- Main Content --- */
        .main-content {
            flex-grow: 1;
            padding: 2.5rem;
        }
        .page-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--color-text-dark);
            margin-bottom: 2rem;
        }

        /* --- Metric Cards --- */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1.5rem;
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .metric-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (min-width: 1024px) { /* lg breakpoint */
            .metric-grid { grid-template-columns: repeat(4, 1fr); }
        }

        .metric-card {
            background-color: var(--color-white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-card);
            border: 1px solid #f3f4f6;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.08);
        }
        .metric-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--color-text-subtle);
            margin-bottom: 0.5rem;
        }
        .metric-value-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .metric-value {
            font-size: 2.25rem;
            font-weight: 800;
        }
        .metric-change {
            display: flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px; /* full rounded */
        }
        .metric-desc {
            font-size: 0.875rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }

        /* Chart/Table Grid */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }
        @media (min-width: 1024px) {
            .data-grid { grid-template-columns: repeat(2, 1fr); }
        }
        .card-chart, .card-table {
            background-color: var(--color-white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-card);
            border: 1px solid #f3f4f6;
        }
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-text-dark);
            margin-bottom: 1rem;
        }

        /* Chart Canvas Container Styles */
        .chart-container {
            height: 300px;
            position: relative;
        }

        /* Table Specific Styles */
        .data-table-wrapper {
            overflow-x: auto;
        }
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        .data-table th, .data-table td {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid #f3f4f6;
        }
        .data-table th {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--color-text-subtle);
            background-color: #f9fafb;
        }
        .data-table tbody tr:hover {
            background-color: #f9fafb;
        }
        .data-table td {
            font-size: 0.875rem;
            color: var(--color-text-dark);
        }
        .data-table .col-desc {
            color: var(--color-text-subtle);
        }

        /* LLM Button Style */
        .llm-button {
            background-color: var(--color-secondary);
            color: white;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-size: 0.8rem;
            box-shadow: 0 2px 4px rgba(139, 92, 246, 0.4);
        }
        .llm-button:hover {
            background-color: #7c4dff;
            transform: translateY(-1px);
        }

        /* --- Modal Styles --- */
        .ai-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .ai-modal-overlay[style*="display: flex"] {
            opacity: 1;
            visibility: visible;
        }
        .ai-modal-content {
            background: var(--color-white);
            padding: 2rem;
            border-radius: var(--border-radius);
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        .ai-modal-overlay[style*="display: flex"] .ai-modal-content {
            transform: scale(1);
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-secondary);
            margin-bottom: 1rem;
        }
        .modal-body {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
            line-height: 1.6;
            color: var(--color-text-dark);
        }
        .modal-body strong {
            display: block;
            margin-top: 1rem;
            font-size: 1.1rem;
            color: var(--color-primary);
        }
        .modal-close-button {
            background-color: #f3f4f6;
            color: var(--color-text-dark);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            float: right;
            transition: background-color 0.2s;
        }
        .modal-close-button:hover {
            background-color: #e5e7eb;
        }

        /* Loader styles for API call */
        .loader {
          border: 4px solid #f3f3f3;
          border-top: 4px solid var(--color-secondary);
          border-radius: 50%;
          width: 24px;
          height: 24px;
          animation: spin 1s linear infinite;
          margin: 0 auto;
        }
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        /* Utility Colors/Icons (for demonstration) */
        .text-blue { color: var(--color-primary); }
        .text-purple { color: var(--color-secondary); }
        .text-green { color: var(--color-success); }
        .text-orange { color: var(--color-warning); }
        .bg-green-light { background-color: #d1fae5; color: #065f46; } /* Tailwind green-100/700 */

        /* Responsive adjustments for mobile */
        @media (max-width: 1023px) {
            .sidebar {
                display: none; /* Hide sidebar on mobile for simplicity, or use a mobile menu component */
            }
            .main-content {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>

<div class="dashboard-layout">

    <div class="sidebar">
        <div class="sidebar-logo">
            <img src="logo.jpg" alt="Plurall AI Logo" title="Plurall AI Logo">
        </div>

        <div class="sidebar-nav">
            <div class="nav-section-title">Detection & Analysis</div>
            <div class="nav-links">

                <div id="nav-dashboard" class="nav-item active" onclick="changePage('dashboard')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                    <span>Dashboard</span>
                </div>

                <div class="nav-item" onclick="changePage('notifications')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.375 21a2 2 0 0 0 3.25 0"/></svg>
                    <span>Notifications</span>
                </div>

                <div class="nav-item" onclick="changePage('real_time_monitoring')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 12h-6"/><path d="M15 9l-3 3 3 3"/><path d="M10 20a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H10z"/><path d="M2 12s2 2 4 0 4-4 4 0"/></svg>
                    <span>Real-Time Monitoring</span>
                </div>

                <div class="nav-item" onclick="changePage('user_verification')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    <span>User Verification</span>
                </div>

                <div class="nav-item" onclick="changePage('content_analysis')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
                    <span>Content Analysis</span>
                </div>

                <div class="nav-item" onclick="changePage('internal_analysis')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 12h-6"/><path d="M15 9l-3 3 3 3"/><path d="M10 20a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H10z"/><path d="M2 12s2 2 4 0 4-4 4 0"/></svg>
                    <span>Internal Analysis</span>
                </div>

                <div class="nav-item" onclick="changePage('industry_analysis')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 12h-6"/><path d="M15 9l-3 3 3 3"/><path d="M10 20a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H10z"/><path d="M2 12s2 2 4 0 4-4 4 0"/></svg>
                    <span>Industry Analysis</span>
                </div>

                <div class="nav-item" onclick="changePage('newsroom')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 12h-6"/><path d="M15 9l-3 3 3 3"/><path d="M10 20a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H10z"/><path d="M2 12s2 2 4 0 4-4 4 0"/></svg>
                    <span>Newsroom</span>
                </div>

            </div>
        </div>

        <div class="sidebar-nav" style="flex-grow: 0; margin-top: 1rem;">
            <div class="nav-section-title">Account</div>
            <div class="nav-links">

                <div id="nav-settings" class="nav-item" onclick="changePage('settings')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
                    <span>Settings</span>
                </div>

                <div class="nav-item" onclick="changePage('help')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                    <span>Help</span>
                </div>

                <div class="nav-item" onclick="changePage('gaussmass')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                    <span>GaussMass 1.0</span>
                </div>

                <div class="nav-item" style="color: #ef4444;" onclick="changePage('logout')">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                    <span>Logout</span>
                </div>

            </div>
        </div>

        <div style="padding: 1.5rem;">
            <div style="background-color: #f5f3ff; padding: 1rem; border-radius: var(--border-radius); text-align: center;">
                <p style="font-size: 0.875rem; font-weight: 600; color: #6d28d9; margin-bottom: 0.5rem;">Get More Personalizations</p>
                <button style="width: 100%; background-color: #8b5cf6; color: white; font-size: 0.875rem; font-weight: 600; padding: 0.5rem; border-radius: 0.5rem; border: none; cursor: pointer; transition: background-color 0.2s;">
                    Upgrade Now
                </button>
            </div>
        </div>

    </div>

    <main class="main-content">
        <h1 class="page-title">Dashboard</h1>

        <div class="metric-grid">

            <div class="metric-card">
                <p class="metric-title">Fraudulent Activities Identified</p>
                <div class="metric-value-wrapper">
                    <div class="metric-value text-blue">160</div>
                    <span class="metric-change bg-green-light">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 4px;"><polyline points="18 15 12 9 6 15"/></svg>
                        12.0%
                    </span>
                </div>
                <p class="metric-desc">Up from past week</p>
            </div>

            <div class="metric-card">
                <p class="metric-title">Suspicious Activities Flagged</p>
                <div class="metric-value-wrapper">
                    <div class="metric-value text-purple">62</div>
                    <span class="metric-change bg-green-light">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 4px;"><polyline points="18 15 12 9 6 15"/></svg>
                        3.0%
                    </span>
                </div>
                <p class="metric-desc">Up from past week</p>
            </div>

            <div class="metric-card">
                <p class="metric-title">Financial Loss Prevented</p>
                <div class="metric-value-wrapper">
                    <div class="metric-value text-green">$120,320</div>
                    <span class="metric-change bg-green-light">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 4px;"><polyline points="18 15 12 9 6 15"/></svg>
                        4.2%
                    </span>
                </div>
                <p class="metric-desc">Up from past week</p>
            </div>

            <div class="metric-card">
                <p class="metric-title">Hours Saved</p>
                <div class="metric-value-wrapper">
                    <div class="metric-value text-orange">68</div>
                    <span class="metric-change bg-green-light">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 4px;"><polyline points="18 15 12 9 6 15"/></svg>
                        1.8%
                    </span>
                </div>
                <p class="metric-desc">Up from past week</p>
            </div>

        </div> <div class="data-grid">

            <div class="card-chart">
                <h3 class="card-title">Fraudulent Activities Identified Over Time</h3>
                <div class="chart-container">
                    <canvas id="fraudChart"></canvas>
                </div>
            </div>

            <div class="card-chart">
                <h3 class="card-title">Financial Loss Prevented (USD)</h3>
                <div class="chart-container">
                    <canvas id="lossChart"></canvas>
                </div>
            </div>

            <div class="card-table data-grid-item" style="grid-column: span 2;">
                <h3 class="card-title">Fraudulent Activities Identified - Details</h3>
                <div class="data-table-wrapper">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Full Name</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Date - Time</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>John Smith</td>
                                <td>Call</td>
                                <td class="col-desc">AI-generated call attempted to include total financial information.</td>
                                <td>10.01.2025 - 12:55 PM</td>
                                <td><button class="llm-button" onclick="analyzeIncident('AI-generated call attempted to include total financial information.', 'AI Call Fraud')">✨ Analyze</button></td>
                            </tr>
                            <tr>
                                <td>Sarah Johnson</td>
                                <td>Call</td>
                                <td class="col-desc">AI voice used to impersonate a senior executive requesting sensitive data.</td>
                                <td>09.30.2025 - 01:25 PM</td>
                                <td><button class="llm-button" onclick="analyzeIncident('AI voice used to impersonate a senior executive requesting sensitive data.', 'Voice Impersonation')">✨ Analyze</button></td>
                            </tr>
                            <tr>
                                <td>Michael Brown</td>
                                <td>Deepfake</td>
                                <td class="col-desc">Deepfake audio message threatening a legal threat sent to multiple customers.</td>
                                <td>09.28.2025 - 2:30 PM</td>
                                <td><button class="llm-button" onclick="analyzeIncident('Deepfake audio message threatening a legal threat sent to multiple customers.', 'Deepfake Audio Threat')">✨ Analyze</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div> <div id="ai-modal" class="ai-modal-overlay" style="display: none;">
            <div class="ai-modal-content">
                <h3 id="modal-title" class="modal-title">AI Incident Analysis</h3>
                <div id="modal-loading" style="display: none; text-align: center; padding: 2rem;">
                    <div class="loader"></div>
                    <p style="margin-top: 1rem; color: var(--color-primary);">Analyzing incident details...</p>
                </div>
                <div id="modal-body" class="modal-body"></div>
                <button onclick="closeModal()" class="modal-close-button">Close</button>
            </div>
        </div>

    </main>

</div>

<script>
    // ------------------- PAGE NAVIGATION LOGIC -------------------
    const PAGE_MAP = {
        'dashboard': 'Dashboard.html',
        'notifications': 'notifications.html',
        'real_time_monitoring': 'real-time-monitoring.html',
        'upload': 'upload.html',
        'user_verification': 'user-verification.html',
        'content_analysis': 'content-analysis.html',
        'internal_analysis': 'internal-analysis.html',
        'industry_analysis': 'industry-analysis.html',
        'newsroom': 'newsroom.html',
        'settings': 'settings.html',
        'help': 'help.html',
        'gaussmass': 'gaussmass.html',
        'logout': 'logout.html'
    };

    window.changePage = function(page) {
        const file = PAGE_MAP[page];
        if (file) {
            window.location.assign(file);
        } else {
            console.error(`Unknown page requested: ${page}`);
        }
    }


    // ------------------- Chart Initialization Logic -------------------

    function initializeCharts() {
        // Get CSS variables for consistent styling
        const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--color-primary').trim();
        const successColor = getComputedStyle(document.documentElement).getPropertyValue('--color-success').trim();
        const subtleColor = getComputedStyle(document.documentElement).getPropertyValue('--color-text-subtle').trim();
        const greyColor = '#e5e7eb'; // Light grey for grid lines

        // --- Chart 1: Fraudulent Activities Identified Over Time (Line Chart) ---
        const fraudCtx = document.getElementById('fraudChart');
        if (fraudCtx) {
            new Chart(fraudCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
                    datasets: [{
                        label: 'Total Identified',
                        data: [120, 150, 135, 180, 160, 200, 190, 210],
                        borderColor: primaryColor,
                        backgroundColor: primaryColor + '22', // Light shade for area fill
                        fill: true,
                        tension: 0.3, // Smoother curve
                        pointRadius: 4,
                        pointBackgroundColor: primaryColor,
                        pointHoverRadius: 6,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: greyColor },
                            ticks: { color: subtleColor }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: subtleColor }
                        }
                    }
                }
            });
        }

        // --- Chart 2: Financial Loss Prevented (Bar Chart) ---
        const lossCtx = document.getElementById('lossChart');
        if (lossCtx) {
            new Chart(lossCtx, {
                type: 'bar',
                data: {
                    labels: ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024'],
                    datasets: [{
                        label: 'Loss Prevented (k$)',
                        data: [80, 120, 105, 140],
                        backgroundColor: successColor,
                        borderRadius: 6, // Rounded bars
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: greyColor },
                            ticks: {
                                callback: (value) => '$' + value + 'k',
                                color: subtleColor
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: subtleColor }
                        }
                    }
                }
            });
        }
    }

    // Initialize charts once the window is fully loaded
    window.onload = initializeCharts;

    // ------------------- Custom Modal Logic -------------------
    function openModal(title) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('ai-modal').style.display = 'flex';
        document.getElementById('modal-loading').style.display = 'block';
        document.getElementById('modal-body').innerHTML = '';
    }

    function closeModal() {
        document.getElementById('ai-modal').style.display = 'none';
    }

    function showResult(text) {
        document.getElementById('modal-loading').style.display = 'none';
        // Format the LLM output for display
        document.getElementById('modal-body').innerHTML = text.replace(/\n/g, '<br>');
    }

    function showError(message) {
        document.getElementById('modal-loading').style.display = 'none';
        document.getElementById('modal-body').innerHTML = `<p style="color: #ef4444; font-weight: 600;">Error:</p><p>${message}</p>`;
    }


    // ------------------- Gemini API Integration Logic -------------------

    const apiKey = "";
    const LLM_MODEL = "gemini-2.5-flash-preview-05-20";
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${LLM_MODEL}:generateContent?key=${apiKey}`;

    // Function for exponential backoff (retry up to 3 times)
    async function retryFetch(url, options, retries = 3) {
        for (let i = 0; i < retries; i++) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    // Check for rate limit or other recoverable errors
                    if (response.status === 429 && i < retries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response;
            } catch (error) {
                if (i < retries - 1) {
                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                } else {
                    throw error;
                }
            }
        }
    }

    /**
     * Calls Gemini to analyze a security incident and suggest remediation.
     * @param {string} incidentDescription - The text description of the fraudulent activity.
     * @param {string} incidentCategory - The category (Call, Deepfake, etc.).
     */
    async function analyzeIncident(incidentDescription, incidentCategory) {
        openModal(`AI Analysis: ${incidentCategory}`);

        const systemPrompt = `You are a world-class Cybersecurity Analyst specializing in AI-driven fraud detection. Your task is to analyze a fraudulent activity description, categorize the threat level (Low, Medium, High, Critical), and provide a concise, two-part response:
1. **ANALYSIS**: Explain in one paragraph the technical mechanism of the fraud (e.g., how AI voice synthesis works or what a deepfake threat entails).
2. **REMEDIATION**: Provide three immediate, bulleted security steps the client must take to mitigate this specific threat and prevent recurrence.
Ensure your tone is professional and actionable. Do not use markdown headers or lists for the main text, only for the bulleted steps.`;

        const userQuery = `Analyze this incident: Category: ${incidentCategory}. Description: "${incidentDescription}"`;

        try {
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                }
            };

            const response = await retryFetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "No analysis generated. The model may have been blocked or returned an empty response.";
            showResult(formatAnalysis(text));

        } catch (error) {
            console.error('API Error:', error);
            showError(`Failed to connect to the AI analyst service. Please check your network or try again later. Details: ${error.message}`);
        }
    }

    function formatAnalysis(text) {
        // Simple function to format the analysis text for better modal display
        let formattedText = text;
        formattedText = formattedText.replace('ANALYSIS:', '<strong>ANALYSIS:</strong>');
        formattedText = formattedText.replace('REMEDIATION:', '<br><br><strong>REMEDIATION:</strong>');
        formattedText = formattedText.replace(/\*/g, '•'); // Replace asterisks with bullets
        return formattedText;
    }
</script>
</body>
</html>